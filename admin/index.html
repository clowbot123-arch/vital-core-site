<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VitalCore Admin</title>
  <link rel="stylesheet" href="/css/style.css" />
  <style>
    body{background: radial-gradient(1200px 600px at 20% 0%, rgba(39,174,96,.14), transparent 60%),
                   radial-gradient(900px 500px at 90% 10%, rgba(230,126,34,.10), transparent 55%),
                   var(--light);}

    .admin-wrap{max-width:1180px;margin:34px auto;padding:0 16px;}

    .admin-top{
      display:flex; align-items:flex-end; justify-content:space-between; gap:16px;
      margin-bottom:18px;
    }
    .admin-top h1{font-size:2.2rem; line-height:1.1; margin:0;}
    .admin-sub{margin-top:6px; color:var(--text-light); max-width:70ch}

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px;
      background:rgba(39,174,96,.10);
      border:1px solid rgba(39,174,96,.20);
      color:var(--secondary);
      font-weight:700;
      font-size:.95rem;
      white-space:nowrap;
    }
    .pill .dot{width:10px;height:10px;border-radius:50%;background:var(--primary); box-shadow:0 0 0 4px rgba(39,174,96,.18)}

    .admin-grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;}

    .admin-card{
      background: rgba(255,255,255,.86);
      border: 1px solid rgba(17,24,39,.10);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 14px 40px rgba(0,0,0,.08);
      position: relative;
      overflow: hidden;
    }

    .admin-card::before{
      content:"";
      position:absolute; inset:-2px;
      background: linear-gradient(135deg, rgba(39,174,96,.25), rgba(230,126,34,.18), rgba(26,26,46,.10));
      opacity:.22;
      pointer-events:none;
    }

    .admin-card > *{position:relative; z-index:1;}

    .admin-card h2{margin:0 0 10px 0; font-size:1.55rem;}
    .admin-card .muted{color:var(--text-light)}

    label{display:block; margin-top:10px; font-weight:700; color:var(--secondary);}

    textarea,input,select{
      width:100%;
      padding:12px 12px;
      border:1px solid rgba(17,24,39,.12);
      background:#ffffff;
      color:var(--text);
      border-radius:14px;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
      outline:none;
    }

    textarea:focus,input:focus,select:focus{
      border-color: rgba(39,174,96,.55);
      box-shadow: 0 0 0 4px rgba(39,174,96,.14);
    }

    textarea{min-height:120px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;}

    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}

    .actions{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;}
    .btn{cursor:pointer}

    pre.list{
      margin-top:12px;
      background: #0f141d;
      color:#e8eefc;
      border-radius:14px;
      padding:12px;
      overflow:auto;
      border:1px solid rgba(17,24,39,.18);
      min-height: 70px;
    }

    .foot{margin-top:18px; color:var(--text-light); font-size:.95rem}
    code{background:rgba(17,24,39,.06); padding:2px 6px; border-radius:8px;}

    @media (max-width: 980px){
      .admin-grid{grid-template-columns:1fr;}
      .admin-top{align-items:flex-start; flex-direction:column;}
    }
  </style>
</head>
<body>
  <div class="admin-wrap">
    <div class="admin-top">
      <div>
        <h1>VitalCore Admin</h1>
        <p class="admin-sub">Protected by Cloudflare Access. Add products and blog entries without redeploying the site.</p>
      </div>
      <div class="pill" title="Cloudflare Access">
        <span class="dot"></span>
        Access protected
      </div>
    </div>

    <div class="admin-grid">
      <section class="admin-card">
        <h2>Add product</h2>
        <div class="row">
          <div>
            <label>Lang</label>
            <select id="p_lang"><option value="en">en</option><option value="de">de</option></select>
          </div>
          <div>
            <label>Slug</label>
            <input id="p_slug" placeholder="advanced-amino" />
          </div>
        </div>
        <label>Title</label>
        <input id="p_title" placeholder="Advanced Amino Acid Complex" />
        <label>Tag</label>
        <input id="p_tag" placeholder="Recovery" />
        <label>Description</label>
        <textarea id="p_desc" placeholder="Short description..."></textarea>
        <label>Bullets (one per line)</label>
        <textarea id="p_bullets" placeholder="Bullet 1\nBullet 2\nBullet 3"></textarea>
        <div class="row">
          <div><label>Old price</label><input id="p_old" placeholder="€108.80" /></div>
          <div><label>New price</label><input id="p_new" placeholder="€39.95" /></div>
        </div>
        <label>Price unit (optional)</label>
        <input id="p_unit" placeholder="/ bottle" />
        <label>Pexels image URL</label>
        <input id="p_img" placeholder="https://images.pexels.com/photos/..." />
        <label>Affiliate URL</label>
        <input id="p_aff" placeholder="https://...#aff=ClawDave" />
        <div class="actions">
          <button class="btn btn-primary" id="btn_add_product">Add product</button>
          <button class="btn btn-secondary" id="btn_load_products">Load products</button>
        </div>
        <pre class="list" id="products_out">Ready.</pre>
      </section>

      <section class="admin-card">
        <h2>Add blog post (index entry)</h2>
        <p class="muted">This stores the post in DB. You can later decide if full articles should be dynamic or stay static.</p>
        <div class="row">
          <div>
            <label>Lang</label>
            <select id="b_lang"><option value="en">en</option><option value="de">de</option></select>
          </div>
          <div>
            <label>Slug</label>
            <input id="b_slug" placeholder="sleep-optimization" />
          </div>
        </div>
        <label>Title</label>
        <input id="b_title" placeholder="Sleep Optimization: The Ultimate Guide" />
        <label>Category</label>
        <input id="b_cat" placeholder="Sleep" />
        <label>Excerpt</label>
        <textarea id="b_excerpt" placeholder="Short excerpt..."></textarea>
        <label>Hero image URL (Pexels)</label>
        <input id="b_img" placeholder="https://images.pexels.com/photos/..." />
        <label>Content HTML (optional)</label>
        <textarea id="b_html" placeholder="<p>...</p>"></textarea>
        <div class="actions">
          <button class="btn btn-primary" id="btn_add_post">Add post</button>
          <button class="btn btn-secondary" id="btn_load_posts">Load posts</button>
        </div>
        <pre class="list" id="posts_out">Ready.</pre>
      </section>
    </div>

    <p class="foot">API base URL: <code id="api_base"></code></p>
  </div>

<script>
  // Local dev server serves the API at the same origin.
  // In production you can keep this as "/api" (recommended) or point to api.vital-core.site.
  const API_BASE = "/api";
  document.getElementById('api_base').textContent = API_BASE;

  const j = (id) => document.getElementById(id);

  function bulletsToArray(s){
    return (s||"").split("\n").map(x=>x.trim()).filter(Boolean);
  }

  async function api(path, opts={}){
    const res = await fetch(API_BASE + path, {
      ...opts,
      headers: {
        "content-type": "application/json",
        ...(opts.headers||{})
      }
    });
    const txt = await res.text();
    let data;
    try{ data = JSON.parse(txt); } catch(e){ data = { raw: txt }; }
    if(!res.ok) throw new Error((data && data.error) ? data.error : ("HTTP " + res.status));
    return data;
  }

  j('btn_add_product').onclick = async () => {
    try{
      const payload = {
        lang: j('p_lang').value,
        slug: j('p_slug').value,
        title: j('p_title').value,
        tag: j('p_tag').value,
        description: j('p_desc').value,
        bullets: bulletsToArray(j('p_bullets').value),
        price_old: j('p_old').value,
        price_new: j('p_new').value,
        price_unit: j('p_unit').value,
        image_url: j('p_img').value,
        affiliate_url: j('p_aff').value,
        featured: false,
        active: true,
      };
      const out = await api('/products', { method: 'POST', body: JSON.stringify(payload) });
      j('products_out').textContent = JSON.stringify(out, null, 2);
    } catch(e){ j('products_out').textContent = String(e); }
  };

  j('btn_load_products').onclick = async () => {
    try{
      const lang = j('p_lang').value;
      const out = await api('/products?lang=' + encodeURIComponent(lang));
      j('products_out').textContent = JSON.stringify(out, null, 2);
    } catch(e){ j('products_out').textContent = String(e); }
  };

  j('btn_add_post').onclick = async () => {
    try{
      const payload = {
        lang: j('b_lang').value,
        slug: j('b_slug').value,
        title: j('b_title').value,
        category: j('b_cat').value,
        excerpt: j('b_excerpt').value,
        hero_image_url: j('b_img').value,
        content_html: j('b_html').value,
        active: true,
      };
      const out = await api('/posts', { method: 'POST', body: JSON.stringify(payload) });
      j('posts_out').textContent = JSON.stringify(out, null, 2);
    } catch(e){ j('posts_out').textContent = String(e); }
  };

  j('btn_load_posts').onclick = async () => {
    try{
      const lang = j('b_lang').value;
      const out = await api('/posts?lang=' + encodeURIComponent(lang));
      j('posts_out').textContent = JSON.stringify(out, null, 2);
    } catch(e){ j('posts_out').textContent = String(e); }
  };
</script>
</body>
</html>
